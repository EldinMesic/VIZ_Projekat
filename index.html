<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <title>Stopa mortaliteta po vrstama smrti</title>

    <style>
        svg .country {
            fill: lightgrey;
        }

        svg .country:hover {
            fill: grey;
        }
    </style>
</head>

<body>

    <div id="select-map-container">
        <svg id="select-map"></svg>
    </div>

    <div id="country-info-container">
        <svg id=""></svg>
        <svg></svg>
    </div>


    <script>

        var width = 960;
        var height = 700;

        var deathData = [];
        fetch("/csvjson.json").then((response) => response.json()).then((json) => deathData = json);


        var projection = d3.geo.mercator()
            .scale(155)
            .translate([width / 2, height / 1.4]);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("#select-map")
            .attr("width", width)
            .attr("height", height)
            .style("background", "lightblue")
            .call(d3.behavior.zoom().scaleExtent([1, 10])
                .on("zoom", onZoom))
            .call(d3.behavior.drag()
                .on("drag", onDrag))
            .append("g");

        d3.json("worldTopo.json", function (error, world) {
            var data = topojson.feature(world, world.objects.countries1);
            var states = svg.selectAll("path.county")
                .data(data.features)
                .enter()
                .append("path")
                .attr("class", "country")
                .attr("id", function (d) { return d.id; })
                .attr("d", path)
                .style("stroke", "black")
                .style("stroke-width", 1)
                .style("stroke-opacity", 1)
                .on("mouseover", function (d) {
                    var country = deathData.find(element => element.Code == d.id);
                    console.log(country);
                    d3.select("#country-info-container").text(d.properties.name);
                })
        });

        function onZoom() {
            svg.attr("transform", "scale (" + d3.event.scale + ") translate(" + d3.event.translate + ")");

        }
        function onDrag() {
        }



    </script>


</body>

</html>